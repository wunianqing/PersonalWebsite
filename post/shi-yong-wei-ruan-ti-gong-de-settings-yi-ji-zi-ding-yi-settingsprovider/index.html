<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>理想乡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="远离喧嚣，静下心来感受世界"/>
<meta name="keywords" content="远离喧嚣，静下心来感受世界"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://www.avaloninparadise.cn/favicon.ico">

<link rel="stylesheet" href="https://www.avaloninparadise.cn/styles/main.css">

<!-- Modernizr JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://www.avaloninparadise.cn/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link href="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css" rel="stylesheet">
    

    



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://www.avaloninparadise.cn/images/avatar.png" alt="理想乡"
                 class="img-responsive">
        </figure>
        <a href="https://www.avaloninparadise.cn/post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>理想乡</h2>
        <p>远离喧嚣，静下心来感受世界</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- 标签 -->
        <div class="fh5co-box">
            <a href="https://www.avaloninparadise.cn/tags/"><h3 class="heading">👉标签</h3></a>
            <ul>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/2ttYE691-/">代码记录</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/5CXSWzvUJ/">C#</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/Xr1Kblx7AI/">EventTracing</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/n5lcfqYL4g/">Tricks</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/UEkd_a4G4/">WPF</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            关于
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://www.avaloninparadise.cn">理想乡 </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

    <!-- 等gridea出自定义页面功能再优化一下 -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://www.avaloninparadise.cn/post-images/shi-yong-wei-ruan-ti-gong-de-settings-yi-ji-zi-ding-yi-settingsprovider.jpg" alt="使用微软提供的Settings以及自定义SettingsProvider" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://www.avaloninparadise.cn/tag/UEkd_a4G4/" class="tag">WPF, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">使用微软提供的Settings以及自定义SettingsProvider</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2019-10-22</li>
                <li>1896字</li>
                <li>10 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <h1 id="前言">前言</h1>
<p>在程序中，难免会用到配置文件。如何处理配置文件问题，有许许多多的解决方案。简单的就是直接在app.config里面加一条，然后读取。复杂一些的，可能需要自己去定义格式，存储位置。微软为我们提供了一个方案，就是在项目中的<code>Settings</code>。<br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-bbfc08a80494db97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Settings" loading="lazy"></p>
<h1 id="使用settings">使用Settings</h1>
<p><code>Settings</code>为我们提供了设置界面，方便操作。使用起来非常简单。<br>
如果你新建一个WPF项目，模板中其实默认就带有一个<code>Settings</code>文件。就像上一节中的插图一样，展开Proerpties即可见。你也可以像添加一般的类一样添加新的<code>Settings</code>文件，只需要在添加文件的窗口中找到<code>Settings</code>类型，添加即可。<br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-2589526e7f2cfbcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加新的Settings文件" loading="lazy"><br>
双击<code>Settings</code>文件，进入可视化编辑界面。<br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-59ae020a7d766b6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="可视化编辑界面" loading="lazy"><br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-68cb99eeca19151b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类型选择" loading="lazy"><br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-1081d79f56e01259.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="作用范围选择" loading="lazy"></p>
<p>第一列是设置项的名称。该值作为将来在程序中获取或设置此项设置时的键。<br>
第二列是设置项的类型。默认有很多的基本类型，注意最有一项，是可以选择自定义类型的。但是也要支持序列化的类型才行，如果是很复杂的类型，需要对其添加序列化和反序列化的方法。<br>
第三项是设置项的作用范围。只有两种选择，Application和User。如果你选择Application，那么该设置项的值不能被修改。如果你选择User，该设置项可以被修改，但是仅针对于当前计算机用户生效。<br>
第四项是设置项的默认值。这个没什么好说的，记得默认值要和类型匹配，不然会编译不通过。</p>
<p>添加完成后，记得点一下保存。VS会帮你生成对应的代码。对应的代码你可以在<code>Settings</code>文件对应的cs文件中找到。<br>
<img src="https://upload-images.jianshu.io/upload_images/1802880-6627dc5b7899fc55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生成的代码位置" loading="lazy"><br>
单项设置对应的代码：</p>
<pre><code class="language-c#">        [global::System.Configuration.UserScopedSettingAttribute()]
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.Configuration.DefaultSettingValueAttribute(&quot;123&quot;)]
        public string Setting {
            get {
                return ((string)(this[&quot;Setting&quot;]));
            }
            set {
                this[&quot;Setting&quot;] = value;
            }
        }
</code></pre>
<p>截图中的设置生成的对应代码：</p>
<pre><code class="language-c#">    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator&quot;, &quot;15.9.0.0&quot;)]
    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase {
        
        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));
        
        public static Settings Default {
            get {
                return defaultInstance;
            }
        }
        
        [global::System.Configuration.UserScopedSettingAttribute()]
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.Configuration.DefaultSettingValueAttribute(&quot;123&quot;)]
        public string Setting {
            get {
                return ((string)(this[&quot;Setting&quot;]));
            }
            set {
                this[&quot;Setting&quot;] = value;
            }
        }
    }
</code></pre>
<p>在CS中使用设置就更简单了。</p>
<pre><code class="language-c#">        static void Main(string[] args)
        {
            //读取设置
            var t = Properties.Settings.Default.Setting;
            Console.WriteLine(t);
            //更新设置
            Properties.Settings.Default.Setting = &quot;6666666&quot;;
            //保存设置
            Properties.Settings.Default.Save();
        }
</code></pre>
<p>如何使用到此结束。</p>
<h1 id="工作流程及原理简述">工作流程及原理简述</h1>
<ol>
<li>可视化界面添加需要的设置项。保存时会生成对应的cs文件，同时，会有对应的xml内容写入app.config。</li>
<li>执行到读取设置时，会根据设置项的作用范围，去读取不同的配置文件。如果没有读取到值，会返回默认值。执行到写入设置时，由于只有User的类型才能写入，系统会调用默认的LocalFileSettingsProvider保存到当前用户的AppData\Local\{ApplicationName}\{Version}\{ApplicationName+LocationHashValue}。</li>
</ol>
<p>原理其实非常简单。每次读或写都生成一个<code>SettingsProvider</code>的实例，然后通过这个实例进行读或者写。你可以通过添加属性来指定<code>SettingsProvider</code>的类型。默认会使用<code>LocalFileSettingsProvider</code>。由于<code>LocalFileSettingsProvider</code>没有提供修改保存路径的方法，我们需要自定义<code>SettingsProvider</code>来修改保存路径。需要将<code>[SettingsProvider(typeof(CustomProvider))]</code>添加到生成的cs类上。</p>
<blockquote>
<p>微软表示不提供路径修改是出于安全考虑。具体的内容请自行参阅官方文档。</p>
</blockquote>
<h1 id="自定义settingsprovider">自定义SettingsProvider</h1>
<p>直接提供给大家一个可以用的。讲解我放在后面。这个类是拔微软源码做的。</p>
<pre><code class="language-cs">    [
         PermissionSet(SecurityAction.LinkDemand, Name = &quot;FullTrust&quot;),
         PermissionSet(SecurityAction.InheritanceDemand, Name = &quot;FullTrust&quot;)
    ]
    public class CustomSettingsProvider : SettingsProvider
    {
        private const string UserSettingsGroupName = &quot;userSettings&quot;;
        private string _applicationName;
        public override string ApplicationName { get =&gt; _applicationName; set =&gt; _applicationName = value; }

        public override void Initialize(string name, NameValueCollection values)
        {
            if (String.IsNullOrEmpty(name))
            {
                name = &quot;CustomProvider&quot;;
            }

            base.Initialize(name, values);
        }

        private Configuration configuration;

        private void Open()
        {
            var fileMap = new ExeConfigurationFileMap
            {
                ExeConfigFilename = $&quot;{_applicationName}.exe.config&quot;,
                RoamingUserConfigFilename = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + &quot;\\&quot; + _applicationName + &quot;\\Settings\\user.config&quot;
            };
            configuration = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.PerUserRoaming);
        }

        [
         FileIOPermission(SecurityAction.Assert, AllFiles = FileIOPermissionAccess.PathDiscovery | FileIOPermissionAccess.Read),
         PermissionSet(SecurityAction.LinkDemand, Name = &quot;FullTrust&quot;),
         PermissionSet(SecurityAction.InheritanceDemand, Name = &quot;FullTrust&quot;)
        ]
        public override SettingsPropertyValueCollection GetPropertyValues(SettingsContext context, SettingsPropertyCollection collection)
        {
            Open();
            var settings = ReadSettingsFromFile(GetSectionName(context));
            var values = new SettingsPropertyValueCollection();
            foreach (SettingsProperty settingProperty in collection)
            {
                var value = new SettingsPropertyValue(settingProperty);
                if (settings.Contains(settingProperty.Name))
                {
                    var ss = (StoredSetting)settings[settingProperty.Name];
                    var valueString = ss.xmlNode.InnerXml;
                    if (ss.serializeAs == SettingsSerializeAs.String)
                    {
                        valueString = Escaper.Unescape(valueString);
                    }
                    value.SerializedValue = valueString;
                }
                else if (settingProperty.DefaultValue != null)
                {
                    value.SerializedValue = settingProperty.DefaultValue;
                }

                value.IsDirty = false;
                values.Add(value);
            }
            return values;
        }

        private XmlEscaper Escaper = new XmlEscaper();

        private IDictionary ReadSettingsFromFile(string sectionName)
        {
            IDictionary settings = new Hashtable();

            var sectionGroup = configuration.GetSectionGroup(UserSettingsGroupName);
            var section = sectionGroup.Sections[sectionName] as ClientSettingsSection;
            if (section != null)
            {
                foreach (SettingElement setting in section.Settings)
                {
                    settings[setting.Name] = new StoredSetting(setting.SerializeAs, setting.Value.ValueXml);
                }
            }

            return settings;
        }

        private string GetSectionName(SettingsContext context)
        {
            string groupName = (string)context[&quot;GroupName&quot;];
            string key = (string)context[&quot;SettingsKey&quot;];

            Debug.Assert(groupName != null, &quot;SettingsContext did not have a GroupName!&quot;);

            string sectionName = groupName;

            if (!String.IsNullOrEmpty(key))
            {
                sectionName = string.Format(CultureInfo.InvariantCulture, &quot;{0}.{1}&quot;, sectionName, key);
            }

            return XmlConvert.EncodeLocalName(sectionName);
        }

        public override void SetPropertyValues(SettingsContext context, SettingsPropertyValueCollection collection)
        {
            string sectionName = GetSectionName(context);
            IDictionary userSettings = new Hashtable();
            foreach (SettingsPropertyValue value in collection)
            {
                SettingsProperty setting = value.Property;
                if (value.IsDirty)
                {
                    StoredSetting ss = new StoredSetting(setting.SerializeAs, SerializeToXmlElement(setting, value));
                    userSettings[setting.Name] = ss;
                }
            }
            WriteSettings(sectionName, userSettings);
        }

        private void WriteSettings(string sectionName, IDictionary newSettings)
        {
            Open();
            var section = GetConfigSection(sectionName);

            if (section != null)
            {
                SettingElementCollection sec = section.Settings;
                foreach (DictionaryEntry entry in newSettings)
                {
                    SettingElement se = sec.Get((string)entry.Key);

                    if (se == null)
                    {
                        se = new SettingElement();
                        se.Name = (string)entry.Key;
                        sec.Add(se);
                    }

                    StoredSetting ss = (StoredSetting)entry.Value;
                    se.SerializeAs = ss.serializeAs;
                    se.Value.ValueXml = ss.xmlNode;
                }

                try
                {
                    configuration.Save();
                }
                catch (ConfigurationErrorsException ex)
                {
                    // We wrap this in an exception with our error message and throw again.
                    throw new ConfigurationErrorsException($&quot;Save file to {configuration.FilePath} failed&quot;, ex);
                }
            }
            else
            {
                throw new ConfigurationErrorsException($&quot;Can not find the section {section} in the setting file&quot;);
            }
        }

        private ClientSettingsSection GetConfigSection(string sectionName)
        {
            Configuration config = configuration;
            string fullSectionName = UserSettingsGroupName + &quot;/&quot; + sectionName;
            ClientSettingsSection section = null;

            if (config != null)
            {
                section = config.GetSection(fullSectionName) as ClientSettingsSection;

                if (section == null)
                {
                    // Looks like the section isn't declared - let's declare it and try again.
                    DeclareSection(sectionName);
                    section = config.GetSection(fullSectionName) as ClientSettingsSection;
                }
            }

            return section;
        }

        // Declares the section handler of a given section in its section group, if a declaration isn't already
        // present. 
        private void DeclareSection(string sectionName)
        {
            Configuration config = configuration;
            ConfigurationSectionGroup settingsGroup = config.GetSectionGroup(UserSettingsGroupName);

            if (settingsGroup == null)
            {
                //Declare settings group
                ConfigurationSectionGroup group = new UserSettingsGroup();
                config.SectionGroups.Add(UserSettingsGroupName, group);
            }

            settingsGroup = config.GetSectionGroup(UserSettingsGroupName);

            Debug.Assert(settingsGroup != null, &quot;Failed to declare settings group&quot;);

            if (settingsGroup != null)
            {
                ConfigurationSection section = settingsGroup.Sections[sectionName];
                if (section == null)
                {
                    section = new ClientSettingsSection();
                    section.SectionInformation.AllowExeDefinition = ConfigurationAllowExeDefinition.MachineToLocalUser;
                    section.SectionInformation.RequirePermission = false;
                    settingsGroup.Sections.Add(sectionName, section);
                }
            }
        }

        private XmlNode SerializeToXmlElement(SettingsProperty setting, SettingsPropertyValue value)
        {
            XmlDocument doc = new XmlDocument();
            XmlElement valueXml = doc.CreateElement(&quot;value&quot;);

            string serializedValue = value.SerializedValue as string;

            if (serializedValue == null &amp;&amp; setting.SerializeAs == SettingsSerializeAs.Binary)
            {
                // SettingsPropertyValue returns a byte[] in the binary serialization case. We need to
                // encode this - we use base64 since SettingsPropertyValue understands it and we won't have
                // to special case while deserializing.
                byte[] buf = value.SerializedValue as byte[];
                if (buf != null)
                {
                    serializedValue = Convert.ToBase64String(buf);
                }
            }

            if (serializedValue == null)
            {
                serializedValue = String.Empty;
            }

            // We need to escape string serialized values
            if (setting.SerializeAs == SettingsSerializeAs.String)
            {
                serializedValue = Escaper.Escape(serializedValue);
            }

            valueXml.InnerXml = serializedValue;

            // Hack to remove the XmlDeclaration that the XmlSerializer adds. 
            XmlNode unwanted = null;
            foreach (XmlNode child in valueXml.ChildNodes)
            {
                if (child.NodeType == XmlNodeType.XmlDeclaration)
                {
                    unwanted = child;
                    break;
                }
            }
            if (unwanted != null)
            {
                valueXml.RemoveChild(unwanted);
            }

            return valueXml;
        }

        private class XmlEscaper
        {
            private XmlDocument doc;
            private XmlElement temp;

            internal XmlEscaper()
            {
                doc = new XmlDocument();
                temp = doc.CreateElement(&quot;temp&quot;);
            }

            internal string Escape(string xmlString)
            {
                if (String.IsNullOrEmpty(xmlString))
                {
                    return xmlString;
                }

                temp.InnerText = xmlString;
                return temp.InnerXml;
            }

            internal string Unescape(string escapedString)
            {
                if (String.IsNullOrEmpty(escapedString))
                {
                    return escapedString;
                }

                temp.InnerXml = escapedString;
                return temp.InnerText;
            }
        }
    }
    internal class StoredSetting
    {
        public StoredSetting(SettingsSerializeAs serializeAs, XmlNode xmlNode)
        {
            this.serializeAs = serializeAs;
            this.xmlNode = xmlNode;
        }
        internal SettingsSerializeAs serializeAs;
        internal XmlNode xmlNode;
    }
</code></pre>
<p>主要的地方在于继承<code>SettingsProvider</code>然后实现两个必须实现的方法，分别是<code>public override SettingsPropertyValueCollection GetPropertyValues(SettingsContext context, SettingsPropertyCollection collection)</code>和<code>public override void SetPropertyValues(SettingsContext context, SettingsPropertyValueCollection collection)</code>。这两个方法会在读和写的时候被调用。之前也提到过，每次读写，都会生成一个新的<code>SettingsProvider</code>的实例，这点需要注意。其中，ApplicationName是在工程设置里Assmebly Information中的值。<br>
可能解释得不是很清楚，有什么问题欢迎留言。当然，更推荐去看<code>LocalFileSettingsProvider</code>的源码。</p>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
            
                <div id="gitalk-container"></div>
            

            
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- 返回顶部 -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li><a href="#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8settings">使用Settings</a></li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0">工作流程及原理简述</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89settingsprovider">自定义SettingsProvider</a></li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>蜀ICP备18034189号-1</p>
</footer>


    <!-- jQuery -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://www.avaloninparadise.cn/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // 代码高亮
    hljs.initHighlightingOnLoad();

    // img 懒加载
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // 懒加载动画
            threshold: 180  // 在图片距离屏幕180px时提前载入
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // 目录
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
</script>



    
        <script src="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: 'da4ce1950c04e8a84b86',
                clientSecret: '218cc92d3af98096d7e1754ffae1bb8580b7ba65',
                repo: 'https://github.com/wunianqing/GittalkForMyBlog.git',
                owner: 'yzhou',
                admin: ['yzhou'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




</body>
</html>
