<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>ç†æƒ³ä¹¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="è¿œç¦»å–§åš£ï¼Œé™ä¸‹å¿ƒæ¥æ„Ÿå—ä¸–ç•Œ"/>
<meta name="keywords" content="è¿œç¦»å–§åš£ï¼Œé™ä¸‹å¿ƒæ¥æ„Ÿå—ä¸–ç•Œ"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://www.avaloninparadise.cn/favicon.ico">

<link rel="stylesheet" href="https://www.avaloninparadise.cn/styles/main.css">

<!-- Modernizr JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://www.avaloninparadise.cn/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link href="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css" rel="stylesheet">
    

    



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://www.avaloninparadise.cn/images/avatar.png" alt="ç†æƒ³ä¹¡"
                 class="img-responsive">
        </figure>
        <a href="https://www.avaloninparadise.cn/post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>ç†æƒ³ä¹¡</h2>
        <p>è¿œç¦»å–§åš£ï¼Œé™ä¸‹å¿ƒæ¥æ„Ÿå—ä¸–ç•Œ</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- æ ‡ç­¾ -->
        <div class="fh5co-box">
            <a href="https://www.avaloninparadise.cn/tags/"><h3 class="heading">ğŸ‘‰æ ‡ç­¾</h3></a>
            <ul>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/2ttYE691-/">ä»£ç è®°å½•</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/5CXSWzvUJ/">C#</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/Xr1Kblx7AI/">EventTracing</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/n5lcfqYL4g/">Tricks</a></li>
                
                    <li><a href="https://www.avaloninparadise.cn/tag/UEkd_a4G4/">WPF</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            å…³äº
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://www.avaloninparadise.cn">ç†æƒ³ä¹¡ </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

    <!-- ç­‰grideaå‡ºè‡ªå®šä¹‰é¡µé¢åŠŸèƒ½å†ä¼˜åŒ–ä¸€ä¸‹ -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://www.avaloninparadise.cn/post-images/shi-yong-roslyn-wei-mei-ge-han-shu-tian-jia-dai-ma.png" alt="ä½¿ç”¨ChromeTracingå·¥å…·ååŠ©å®šä½bug" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://www.avaloninparadise.cn/tag/5CXSWzvUJ/" class="tag">C#, </a>
                        
                            <a href="https://www.avaloninparadise.cn/tag/Xr1Kblx7AI/" class="tag">EventTracing, </a>
                        
                            <a href="https://www.avaloninparadise.cn/tag/n5lcfqYL4g/" class="tag">Tricks, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">ä½¿ç”¨ChromeTracingå·¥å…·ååŠ©å®šä½bug</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2020-09-23</li>
                <li>1706å­—</li>
                <li>8 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>ä¸çŸ¥å„ä½æ˜¯å¦ç»å†è¿‡å¤šçº¿ç¨‹bugçš„åœ°ç‹±ã€‚åœ¨å„ç§çº¿ç¨‹çš„æ—¶åºä¹‹é—´æ¥å›æŒ£æ‰ï¼Œå¤§æ¦‚å°±æ˜¯å†™å¤šçº¿ç¨‹çš„ç—›ã€‚åˆ°åº•æ˜¯è°å…ˆè°åï¼Œä¸¤æ¬¡è¿è¡Œä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™ä¼šå¤ç°bugï¼Œæœ‰çš„æ—¶å€™å°±ä¸èƒ½ã€‚æ­¤ç±»é—®é¢˜ä¼šä»¤äººæ€€ç–‘äººç”Ÿã€‚åœ¨è¯»å®Œæœ¬æ–‡åï¼Œè¿™äº›éƒ½å°†æˆä¸ºè¿‡å»å¼ï¼</p>
<h1 id="chrome-tracing-tool">Chrome Tracing Tool</h1>
<p>Chrome Tracing Toolæ˜¯chromeæµè§ˆå™¨æä¾›çš„ä¸€ä¸ªå·¥å…·ã€‚è¯¥å·¥å…·è€ƒå¯ä»¥å½•åˆ¶æˆ–åŠ è½½å·²å½•åˆ¶å¥½çš„æ•°æ®ï¼Œå¹¶å°†å…¶å¯è§†åŒ–çš„å±•ç°ç»™ç”¨æˆ·ï¼Œä»¥ä¾¿ç”¨æˆ·è¿›è¡Œåˆ†æã€‚æ²¡é”™ï¼Œå°±æ˜¯ä¸ºäº†ææ¸…æ¥šï¼Œä»£ç åœ¨è¿è¡Œæ—¶ï¼Œåˆ°åº•å¹²äº†ä»€ä¹ˆã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</h2>
<h3 id="1-ç”Ÿæˆæ•°æ®">1. ç”Ÿæˆæ•°æ®</h3>
<p>ç”±äºæˆ‘ä¸æ˜¯æwebçš„ï¼Œæ‰€ä»¥å½•åˆ¶å¯¹æˆ‘æ¥è¯´æ²¡ä»€ä¹ˆç”¨ã€‚æ‰€ä»¥æˆ‘å¾—è‡ªå·±ç”Ÿæˆæ•°æ®ã€‚å…·ä½“çš„æ•°æ®æ ¼å¼è¯·çœ‹<a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit?pli=1">æ–‡æ¡£</a>ã€‚<br>
ç‰¹åˆ«å¤æ‚çš„æˆ‘åæ­£æ˜¯æ²¡ç”¨ä¸Šï¼Œæ‰€ä»¥åŸºæœ¬çš„jsonæ ¼å¼å°±æ˜¯</p>
<pre><code class="language-json">{
    &quot;traceEvents&quot; : [
        {
            &quot;cat&quot;: &quot;function&quot;, //åˆ†ç±»
            &quot;dur&quot;: 20, //æŒç»­æ—¶é—´
            &quot;name&quot;: &quot;Event1&quot;,  //äº‹ä»¶åç§°
            &quot;ph&quot;: &quot;X&quot;,
            &quot;pid&quot;: 0,  //è¿›ç¨‹ID
            &quot;tid&quot;: 1,  //çº¿ç¨‹ID
            &quot;ts&quot;: 0,  //äº‹ä»¶èµ·å§‹æ—¶é—´
            &quot;args&quot;: {  //é¢å¤–å‚æ•°
                &quot;filePath&quot;: &quot;sc file path1&quot;
            }
        },
        {
            &quot;cat&quot;: &quot;function&quot;, //åˆ†ç±»
            &quot;dur&quot;: 20, //æŒç»­æ—¶é—´
            &quot;name&quot;: &quot;Event2&quot;,  //äº‹ä»¶åç§°
            &quot;ph&quot;: &quot;X&quot;,
            &quot;pid&quot;: 0,  //è¿›ç¨‹ID
            &quot;tid&quot;: 2,  //çº¿ç¨‹ID
            &quot;ts&quot;: 10,  //äº‹ä»¶èµ·å§‹æ—¶é—´
            &quot;args&quot;: {  //é¢å¤–å‚æ•°
                &quot;filePath&quot;: &quot;sc file path2&quot;
            }
        }
    ]
}
</code></pre>
<h3 id="2-åœ¨chromeä¸­æ‰“å¼€">2. åœ¨chromeä¸­æ‰“å¼€</h3>
<p>å°†ä¸Šé¢çš„jsonä¿å­˜ï¼Œç„¶åæ‰“å¼€chromeï¼Œåœ°å€æ è¾“å…¥<code>Chrome://Tracing</code>æŒ‰å›è½¦ã€‚æˆ‘è¿™è¾¹ç”¨çš„Edgeï¼Œæ‰€ä»¥åœ°å€æ ç¨ç¨æœ‰ç‚¹å˜åŒ–ã€‚æ€»ä¹‹ä¼šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š<br>
<img src="https://www.avaloninparadise.cn/post-images/1600916179025.png" alt="EdgeTracing" loading="lazy"><br>
ä¹‹åæˆ‘ä»¬ç‚¹å·¦ä¸Šè§’çš„loadæŒ‰é’®ï¼Œé€‰ä¸­æˆ‘ä»¬çš„æ•°æ®ã€‚<strong>æ³¨æ„ä¸è¦ç›´æ¥ç²˜è´´ä¹‹å‰æ–‡ç« ä¸­çš„jsonï¼Œå› ä¸ºjsonæ˜¯ä¸å…è®¸æ³¨é‡Šçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨æŠŠé‚£äº›æ³¨é‡Šéƒ½å»æ‰ã€‚</strong><br>
<img src="https://www.avaloninparadise.cn/post-images/1600916513250.png" alt="å®ŒæˆåŠ è½½" loading="lazy"></p>
<h3 id="3-æŸ¥çœ‹æ•°æ®">3. æŸ¥çœ‹æ•°æ®</h3>
<p>è¿™ä¸ªå°±è‡ªå·±æ‘¸ç´¢å•¦ã€‚å¯ä»¥ç”¨é¼ æ ‡ç‚¹ç‚¹ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨é”®ç›˜ã€‚æœ€è¿‘å¸¸ç”¨çš„æ˜¯<code>A</code>å’Œ<code>D</code>ï¼Œå¯¹åº”å¾€å·¦å’Œå¾€å³ï¼Œ<code>W</code>å’Œ<code>S</code>å¯¹åº”çš„æ˜¯æ”¾å¤§å’Œç¼©å°ã€‚</p>
<h1 id="å¦‚ä½•ç”Ÿæˆæ•°æ®">å¦‚ä½•ç”Ÿæˆæ•°æ®ï¼Ÿ</h1>
<p>å¾ˆæ˜æ˜¾ï¼Œç”±äºä¸èƒ½å½•åˆ¶ï¼Œå¦‚ä½•ç”Ÿæˆæ•°æ®å°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä½å°å“¥çš„è§†é¢‘ï¼ˆ<a href="https://www.bilibili.com/video/BV1VJ411M7WR?p=81">Bç«™</a>ï¼Œ<a href="https://www.youtube.com/watch?v=xlAH4dbMVnU&amp;list=PLlrATfBNZ98dudnM48yfGUldqGD0S4FFb&amp;index=81">åŸè§†é¢‘</a>ï¼‰ã€‚æˆ‘ä¼šå‘Šè¯‰ä½ æˆ‘å°±æ˜¯ä»è¿™å­¦æ¥çš„å—ï¼Ÿä¸ºäº†é¿å…ä½ ä»¬å¤ªé•¿ä¸çœ‹ï¼Œæˆ‘æŠŠgithubçš„æ–‡ä»¶åœ°å€ä¹Ÿæ”¾åœ¨<a href="https://github.com/TheCherno/Hazel/blob/0090b94af9be167cf5c399d8091c58e78bff41fd/Hazel/src/Hazel/Debug/Instrumentor.h">è¿™é‡Œ</a>äº†ã€‚<br>
C++çš„è¯å‚è€ƒå°å“¥çš„å°±å¯ä»¥äº†ï¼Œå…¶å®è¿˜åº”è¯¥æŠŠå†™æ–‡ä»¶ç”¨é˜Ÿåˆ—å»åšä»¥å…å½±å“åˆ°æ€§èƒ½ã€‚ä½†æ˜¯C#åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸC#ä¹Ÿæ²¡æœ‰åƒC++ä¸€æ ·çš„ç‰¹æ€§ï¼ˆæ²¡çœ‹è§†é¢‘çš„ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆï¼‰ã€‚å”¯ä¸€ç±»ä¼¼çš„å°±æ˜¯usingäº†ï¼Œèƒ½å¤Ÿè‡ªåŠ¨çš„åœ¨ç»“æŸæ—¶è°ƒç”¨Disposeæ–¹æ³•ã€‚è™½ç„¶å¯èƒ½ä¼šå½±å“åˆ°GCï¼Œä½†æ˜¯æˆ‘ç”¨C#ä¹Ÿä¸åšä»€ä¹ˆé«˜æ€§èƒ½çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ— æ‰€è°“äº†ã€‚æˆ‘æŠŠæˆ‘è‡ªå·±ç”¨çš„ä»£ç è´´åœ¨è¿™é‡Œã€‚</p>
<blockquote>
<p>è¿™é‡Œå¿…é¡»åæ§½ä¸€ä¸‹Grideaï¼Œä¸èƒ½ä¸Šä¼ æ–‡ä»¶å°±æ˜¯å¾ˆéš¾å—ã€‚ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯github pageçš„é™åˆ¶ï¼Œç­‰æˆ‘æœ‰ç©ºäº†è‡ªå·±æ·»åŠ è¿™ä¸ªåŠŸèƒ½è¯•è¯•çœ‹ã€‚</p>
</blockquote>
<p>AutoEventTracer.cs</p>
<pre><code class="language-c#">
using System;
using System.Runtime.CompilerServices;

namespace EventTracing
{
    public class AutoEventTracer : IDisposable
    {
        public void Dispose()
        {
            EventTracer.TraceEvent(_marker,_eventName,_filePath);
        }

        private readonly EventTraceMaker _marker;
        private readonly string _eventName;
        private readonly string _filePath;

        public AutoEventTracer([CallerMemberName] string eventName = null, [CallerFilePath] string filePath = null)
        {
            _marker = EventTracer.StartTrace();
            _eventName = eventName;
            _filePath = filePath;
        }
    }
}
</code></pre>
<p>EventTraceMaker.cs</p>
<pre><code class="language-c#">using System;

namespace EventTracing
{
    public class EventTraceMaker
    {
        private readonly DateTime m_startTime;
        private double m_duration;
        internal EventTraceMaker()
        {
            m_startTime = DateTime.Now;
        }

        internal void Stop()
        {
            m_duration = (DateTime.Now - m_startTime).TotalMilliseconds;
        }

        internal double GetDuration()
        {
            return m_duration;
        }
        internal DateTime StartTime { get { return m_startTime; } }
    }
}
</code></pre>
<p>EventTracer.cs</p>
<pre><code class="language-c#">using System;
using System.Runtime.CompilerServices;
using System.Threading;
using System.Collections.Concurrent;
using System.IO;
using System.Threading.Tasks;

namespace EventTracing
{
    public class EventTracer
    {
        private readonly BlockingCollection&lt;string&gt; m_messageQueue;
        private EventTracer()
        {
            m_messageQueue = new BlockingCollection&lt;string&gt;();
        }


        private Task m_saveTask;
        private async void SaveTraceInfo(string filePath)
        {
            m_saveTask = Task.Run(() =&gt;
            {
                using var fs = File.Open(filePath, FileMode.Create, FileAccess.Write);
                using var sw = new StreamWriter(fs);
                foreach (var message in m_messageQueue.GetConsumingEnumerable())
                {
                    sw.Write(message);
                    sw.Flush();
                }
            });
            await m_saveTask;
        }

        public static void Init(string filePath)
        {
            s_instance.IInit(filePath);
        }
        private bool m_traceInited = false;
        public void IInit(string filePath)
        {
            if (m_traceInited)
                throw new Exception(&quot;Tracing already initialized.&quot;);
            m_traceInited = true;
            SaveTraceInfo(filePath);
        }

        private static readonly EventTracer s_instance;
        private static readonly DateTime s_applicationStartTime;

        static EventTracer()
        {
            s_instance = new EventTracer();
            s_applicationStartTime = DateTime.Now;
            s_instance.m_messageQueue.Add(&quot;{\&quot;otherData\&quot;:{},\&quot;displayTimeUnit\&quot;:\&quot;ms\&quot;,\&quot;traceEvents\&quot;:[{}&quot;);
        }

        public static EventTracer GetInstance()
        {
            return s_instance;
        }

        public static EventTraceMaker StartTrace()
        {
            return s_instance.IStartTrace();
        }

        public EventTraceMaker IStartTrace()
        {
            return new EventTraceMaker();
        }

        public static void TraceEvent(EventTraceMaker marker, [CallerMemberName] string eventName = null, [CallerFilePath] string filePath = null)
        {
            s_instance.ITraceEvent(marker, eventName, filePath);
        }

        public void ITraceEvent(EventTraceMaker marker, [CallerMemberName] string eventName = null, [CallerFilePath] string filePath = null)
        {
            marker.Stop();
            var message = $&quot;,{{\&quot;cat\&quot;:\&quot;function\&quot;,\&quot;dur\&quot;:{marker.GetDuration() * 1000},\&quot;name\&quot;:\&quot;{eventName}\&quot;,\&quot;ph\&quot;:\&quot;X\&quot;,\&quot;pid\&quot;:0,\&quot;tid\&quot;:{Thread.CurrentThread.ManagedThreadId},\&quot;ts\&quot;:{(marker.StartTime - s_applicationStartTime).TotalMilliseconds * 1000},\&quot;args\&quot;:{{\&quot;filePath\&quot;:\&quot;{filePath.Replace(&quot;\\&quot;, &quot;\\\\&quot;)}\&quot;}}}}&quot;;
            m_messageQueue.Add(message);
        }


        public static void EndTrace()
        {
            s_instance.m_messageQueue.CompleteAdding();
            s_instance.m_saveTask.Wait();
            s_instance.IEndTrace();
        }
        private bool m_traceEnded = false;
        public void IEndTrace()
        {
            if (m_traceEnded)
                throw new Exception(&quot;Tracing has already ended.&quot;);
            m_traceEnded = true;
            m_messageQueue.Add(&quot;]}&quot;);
            m_messageQueue.CompleteAdding();
        }
    }

}
</code></pre>
<h2 id="åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨">åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2>
<p>è¯·å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚åŒæ—¶è®°å¾—åœ¨ç¨‹åºå¼€å§‹å’Œç»“æŸæ—¶åˆ†åˆ«è°ƒç”¨<code>EventTracer.Init(filePath)</code>å’Œ<code>EventTracer.EndTrace()</code>ã€‚</p>
<pre><code class="language-c#">//åœ¨ä»»ä½•ä½ éœ€è¦è®°å½•çš„åœ°æ–¹ç›´æ¥ç”¨ï¼
public  void Test()
{
    using (var tracer = new AutoEventTracer())
    {
        //your actual code here
    }
}

public  void Test1()
{
    //æ‰‹åŠ¨æŒ‡å®šäº‹ä»¶å
    using (var tracer = new AutoEventTracer(&quot;Test1Event&quot;))
    {
        //your actual code here
    }
}
</code></pre>
<h1 id="å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨">å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h1>
<p>æœ‰è¯»è€…å¯èƒ½ä¼šæƒ³äº†ï¼šäº²ï¼Œä½ è¯´çš„éƒ½å¯¹ï¼Œä½†æ˜¯æˆ‘æ€»ä¸èƒ½ä¸€ç‚¹ä¸€ç‚¹çš„å¾€å·²æœ‰é¡¹ç›®æ·»åŠ å§ã€‚<br>
æ·¡å®šï¼Œè´´å¿ƒå¦‚æˆ‘å·²ç»å¸®ä½ æƒ³å¥½äº†ï¼è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼è¿è¡Œå®ƒå°±èƒ½å¤Ÿå¾€æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„csæ–‡ä»¶ä¸­çš„<strong>æ¯ä¸ªå‡½æ•°ä½“</strong>æ·»åŠ AutoEventTracerã€‚ç¼ºç‚¹å°±æ˜¯å¯èƒ½ä¼šæŠŠä¸€äº›æ— å…³ç´§è¦çš„å‡½æ•°ä¹Ÿæ·»åŠ ä¸Šï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±å¾—æ‰‹åŠ¨å»æ”¹å•¦ã€‚<strong>è¿è¡Œå‰è®°å¾—ç‰ˆæœ¬å¤‡ä»½ï¼Œç©åäº†æˆ‘ä¸è´Ÿè´£ã€‚</strong></p>
<blockquote>
<p>å¦‚ä½•ç¼–è¯‘ä¸‹é¢çš„codeè¯·å‚è€ƒ<a href="https://blog.walterlv.com/post/analysis-code-of-existed-projects-using-roslyn">è¿™ç¯‡æ–‡ç« </a>ã€‚<br>
å¯¹Roslynæ„Ÿå…´è¶£è¯·é˜…è¯»<a href="https://joshvarty.com/learn-roslyn-now/">æ­¤ç³»åˆ—</a><br>
æƒ³çŸ¥é“æˆ‘é‚£ä¸²linqæ€ä¹ˆå†™çš„ï¼Œçœ‹<a href="http://roslynquoter.azurewebsites.net/">è¿™é‡Œ</a></p>
</blockquote>
<pre><code class="language-c#">class Program
    {
        static void Main(string[] args)
        {
            DoWork();
        }

        static void DoWork()
        {
            var files = GetAllCSharpFilesInFolder(@&quot;your file path&quot;);
            Parallel.For(0, files.Length, (i) =&gt;
              {
                  Console.WriteLine($&quot;{i} working on {files[i]}&quot;);
                  ParseCsharpFile(files[i]);
                  Console.WriteLine($&quot;{i} working on {files[i]}&quot;);
              });
        }

        static string[] GetAllCSharpFilesInFolder(string folder)
        {
            var directoryInfo = new DirectoryInfo(folder);
            return directoryInfo
                .GetFiles(&quot;*.cs&quot;, SearchOption.AllDirectories)
                .Select(fi=&gt;fi.FullName).ToArray();
        }

        static async Task ParseCsharpFileAsync(string filePath)
        {
            await Task.Run(() =&gt; ParseCsharpFile(filePath));
        }

        static void ParseCsharpFile(string filePath)
        {
            SyntaxNode result = null;
            using (var fs = File.Open(filePath, FileMode.Open, FileAccess.Read))
            {
                using (var sr = new StreamReader(fs))
                {
                    var rewriter = new AddEventTrace();
                    result = rewriter.Visit(CSharpSyntaxTree.ParseText(sr.ReadToEnd()).GetRoot());
                }
            }
            File.WriteAllText(filePath, result.ToFullString());
        }
    }

    class AddEventTrace : CSharpSyntaxRewriter
    {
        public override SyntaxNode VisitBlock(BlockSyntax node)
        {
            var usingStatement = SyntaxFactory.UsingStatement(SyntaxFactory.Block(node.Statements))
                            .WithDeclaration(
                                SyntaxFactory.VariableDeclaration(
                                    SyntaxFactory.IdentifierName(
                                        SyntaxFactory.Identifier(
                                            SyntaxFactory.TriviaList(),
                                            &quot;var&quot;,
                                            SyntaxFactory.TriviaList(
                                                SyntaxFactory.Space))))
                                .WithVariables(
                                    SyntaxFactory.SingletonSeparatedList&lt;VariableDeclaratorSyntax&gt;(
                                        SyntaxFactory.VariableDeclarator(
                                            SyntaxFactory.Identifier(SyntaxFactory.TriviaList(),
                                            &quot;eventTracer&quot;,
                                            SyntaxFactory.TriviaList(
                                                SyntaxFactory.Space)))
                                        .WithInitializer(
                                            SyntaxFactory.EqualsValueClause(
                                                SyntaxFactory.ObjectCreationExpression(
                                                    SyntaxFactory.IdentifierName(SyntaxFactory.Identifier(&quot;EventTracer&quot;)))
                                                    .WithNewKeyword(
                                                    SyntaxFactory.Token(
                                                        SyntaxFactory.TriviaList(SyntaxFactory.Space),
                                                        SyntaxKind.NewKeyword,
                                                        SyntaxFactory.TriviaList(
                                                            SyntaxFactory.Space)))
                                                    .WithArgumentList(
                                                    SyntaxFactory.ArgumentList()))
                                            ))));
            return node.Update(node.OpenBraceToken, new SyntaxList&lt;SyntaxNode&gt;(usingStatement), node.CloseBraceToken);
        }
    }
    ```</code></pre>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">ä¸‹ä¸€ç¯‡</div>
                                <a href="https://www.avaloninparadise.cn/post/shou-dong-chuang-jian-telerik-kong-xiang-mu-telerik-for-wpf/">
                                    <h3 class="post-title">
                                        æ‰‹åŠ¨åˆ›å»ºTelerikç©ºé¡¹ç›®(Telerik for WPF)
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
            
                <div id="gitalk-container"></div>
            

            
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- è¿”å›é¡¶éƒ¨ -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li><a href="#%E8%83%8C%E6%99%AF">èƒŒæ™¯</a></li>
<li><a href="#chrome-tracing-tool">Chrome Tracing Tool</a>
<ul>
<li><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">å¦‚ä½•ä½¿ç”¨</a>
<ul>
<li><a href="#1-%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE">1. ç”Ÿæˆæ•°æ®</a></li>
<li><a href="#2-%E5%9C%A8chrome%E4%B8%AD%E6%89%93%E5%BC%80">2. åœ¨chromeä¸­æ‰“å¼€</a></li>
<li><a href="#3-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE">3. æŸ¥çœ‹æ•°æ®</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE">å¦‚ä½•ç”Ÿæˆæ•°æ®ï¼Ÿ</a>
<ul>
<li><a href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li>
</ul>
</li>
<li><a href="#%E5%B7%B2%E6%9C%89%E9%A1%B9%E7%9B%AE%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>èœ€ICPå¤‡18034189å·-1</p>
</footer>


    <!-- jQuery -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://www.avaloninparadise.cn/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://www.avaloninparadise.cn/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://www.avaloninparadise.cn/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // ä»£ç é«˜äº®
    hljs.initHighlightingOnLoad();

    // img æ‡’åŠ è½½
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // æ‡’åŠ è½½åŠ¨ç”»
            threshold: 180  // åœ¨å›¾ç‰‡è·ç¦»å±å¹•180pxæ—¶æå‰è½½å…¥
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // ç›®å½•
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
</script>



    
        <script src="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: 'da4ce1950c04e8a84b86',
                clientSecret: '218cc92d3af98096d7e1754ffae1bb8580b7ba65',
                repo: 'https://github.com/wunianqing/GittalkForMyBlog.git',
                owner: 'yzhou',
                admin: ['yzhou'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




</body>
</html>
